#!/usr/bin/env node
/* eslint-disable no-console */
'use strict';

let argv = require('yargs')
    .usage('Usage: dump_describes [options]')

    .alias('f', 'file')
    .nargs('f', 1)
    .describe('f', 'The suite to parse')

    .describe('html', 'Creates an html document of the tree')
    .boolean('html')

    .alias('v', 'verbose')
    .boolean('v')
    .describe('v', 'Dumps `it` blocks')

    .help('h')
    .alias('h', 'help')
    .argv,

    // Default to logging to stdout.
    printer = require(`../lib/printer/${!argv.html ? 'log' : 'html'}`),
    makeTree = require('../lib/makeTree'),
    file = argv.file;


if (!file) {
    let stdin = process.stdin,
        buf;

    stdin.setEncoding('utf8');

    stdin.on('readable', () => {
        let chunk = stdin.read();

        if (chunk !== null) {
          buf += chunk;
        }
    });

    stdin.on('end', () => {
        makeTree(buf, printer, argv.verbose, true);
    });
} else {
    makeTree(file, printer, argv.verbose, false);
}

